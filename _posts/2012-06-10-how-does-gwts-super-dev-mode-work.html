---
layout: post
title: How does GWT's Super Dev Mode work?
published: true
---
<p>GWT's Super Dev Mode (aka Super Draft Mode) was first teased&nbsp;<a href="https://plus.google.com/110412141990454266397/posts/iqXo5AyHkyd#z120g3uxpovdcl4bu04cg3exqlvcjz4hfmk0k#1319388659031000" title="Brian Slesinsky and I are working on a &quot;Super Draft Mode&quot; GWT compiler spec that will eliminate the need for DevMode.">months ago</a>, then&nbsp;<a href="https://groups.google.com/d/msg/google-web-toolkit-contributors/FGA1YaxIr8g/frw2lLu4mKQJ" title="Brian and Ray has been experimenting with different approaches to debug dev mode that steer away from browser plugins / APIs.">regularly</a>&nbsp;<a href="https://plus.google.com/117487419861992917007/posts/6YWpsHpqMqZ#z130etb55t3bcx4l122kj5nzbz2hvrwke#1323192348247049" title="A &quot;super draft mode&quot; that can recompile many apps in under 10 seconds and most under 5">until</a> <a href="https://plus.google.com/110412141990454266397/posts/Nvr6Se6eAPh" title="I've been meaning to do this screencast for weeks, ever since I first showed the screenshot of SuperDevMode and SourceMaps working.">it</a>&nbsp;<a href="https://plus.google.com/110412141990454266397/posts/3YuCbLDYV7v#z13wzrtxntr0vfbsj230urhoiu3zt3ewo04#1333616272891049" title="I have dependencies in SuperDevMode that require it">finally</a>&nbsp;<a href="http://code.google.com/p/google-web-toolkit/source/detail?r=11016" title="Move Super Dev Mode to the open source repository.">landed</a>&nbsp;last week, for your testing pleasure.</p>
<h2>So, what is this Dev Mode on steroids?</h2>
<p>Before answering this question, let's first go back to what Dev Mode is: it's composed of a browser plugin and a&nbsp;<em>code server</em>, talking to each other through a TCP socket to execute your GWT code in a JVM yet still interact with your browser (and execute JSNI methods), without the need to first go through a slow compilation phase. GWT's Dev Mode also (optionally) embeds a Servlet container (by default based on Jetty 6, but pluggable) so it can run your server-side code as well. A diagram can be found on the&nbsp;<a href="https://developers.google.com/web-toolkit/doc/latest/DevGuideCompilingAndDebugging#DevGuideDevMode" title="Debugging in Development Mode">GWT Dev Guide</a>:</p>
<p style="text-align: center;"><img title="Debugging in Development Mode" src="https://developers.google.com/web-toolkit/doc/latest/images/DevModeTypical.jpg" alt="" /></p>
<p>One advantage of Dev Mode is that, running your client code in a JVM, you can use a standard Java debugger, with breakpoints, variable inspection, etc. Moreover, running the server-side code in the same JVM make it even easier to debug (best for small apps though). The downside to that is that a browser plugin is required (it has to block JS execution in the UI thread, but a synchronous XMLHttpRequest wouldn't have provided sufficient performance &ndash;Dev Mode is rather chatty; moreover synchronous XHR are&nbsp;<a href="http://trac.webkit.org/changeset/118599" title="A setting has been added for disabling synchronous XMLHTTPRequest requests.">being phased out</a>&ndash;, and it has to have knowledge of when JS objects are finalized, so that their <em>Java proxies</em> can be garbaged collected).</p>
<p>There are many issues with requiring a browser plugin:</p>
<ul>
<li>each browser has its own API (at least for the needs of Dev Mode, which has to&nbsp;<em>branch</em>&nbsp;into the JS engine, and provide a configuration screen), that means you have to maintain one plugin per browser, and per platform. This is why the plugin is only available for Internet Explorer (obviously Windows-only), Firefox (all platforms), Chrome (all platforms), and Safari (on Mac only). This leaves out Opera, Safari on Windows, and of course mobile browsers!</li>
<li>you need to be able to run a plugin: this is impossible in Web Workers, and challenging (if at all possible) in browser extensions, and again impossible in mobile browsers.</li>
<li>the plugin has to be updated with each new version of Firefox, because it's a so-called&nbsp;<em>binary extension</em>&nbsp;and&nbsp;the Gecko SDK changes with each release. This has become problematic when Mozilla switched to a rapid release process last year. While mitigated since February with the introduction of the&nbsp;<a href="http://www.mozilla.org/en-US/firefox/organizations/" title="Extended Support Release">ESR</a>, it still makes it impossible to use Dev Mode in Beta or Aurora (even less Nightly) versions of Firefox, and sticking to the ESR (which is&nbsp;<em>not</em>&nbsp;the case)&nbsp;would make it impossible to use bleeding edge features in Dev Mode.</li>
<li>Dev Mode has some requirements on the browser API, which are not always fulfilled: it can break in Chrome, sporadically, to the point that the GWT Team&nbsp;<a href="http://code.google.com/p/google-web-toolkit/issues/detail?id=5778#c65" title="Sorry for the inconvenience, and yes, I would recommend Firefox at this time as a workaround.">recommends using another browser</a>.</li>
</ul>
<p>In a few words, maintaining Dev Mode has become a nightmare: the plugin has to be updated every 6 weeks, and developers becomre paranoid that their Firefox updates before the new Dev Mode; and Chrome is hardly usable, because its behavior is unstable and unpredictable; there seems to be issues in Safari too, and IE9 support&nbsp;<a href="http://googlewebtoolkit.blogspot.fr/2011/03/update-on-gwt-support-for-ie9.html" title="The IE9 dev mode issue reported back in Dec is fixed">required some changes</a>&nbsp;too.</p>
<h2>The road to Super Dev Mode</h2>
<p>During the last few years, Google has been working, as part of their Closure Tools, on a way to debug&nbsp;<em>compiled JavaScript</em>&nbsp;(produced by the Closure Compiler, initially) as if was the one you originally wrote. They first wrote the Closure Inspector, as an extension to Firebug, and then with the rise of&nbsp;<em>compiled-to-JS</em>&nbsp;languages (CoffeeScript and the like), they refined their work and started collaborating with Mozilla to produce a spec of what's now called&nbsp;<a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/" title="Introduction to JavaScript Source Maps">Source Maps</a>: a way to map your&nbsp;<em>compiled JS</em>&nbsp;back to its original source, whichever the original language. The Closure Inspector is no longer maintained (and no longer works with recent versions of Firefox and Firebug), but Chrome now has built-in support, and Mozilla being actively working on their new developer tools should have it too at some point. It's only a matter of time for Safari, Opera and Internet Explorer to support them too (Opera Dragonfly is&nbsp;<a href="https://bitbucket.org/scope/dragonfly-stp-1/" title="Opera Dragonfly repository on Bitbucket">open source</a>, so if you feel like contributing Source Maps support, go ahead!)</p>
<p>Mobile browsers have also gained&nbsp;<em>remote debugging</em>, almost all:&nbsp;<a href="https://developers.google.com/chrome/mobile/docs/debugging">Chrome for Android</a>,&nbsp;<a href="http://lucasr.org/2012/03/28/remote-debugging-in-firefox-mobile/">Firefox</a>(<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=739966">soon</a>),&nbsp;<a href="http://www.opera.com/dragonfly/documentation/remote/">Opera</a>&nbsp;(<a href="http://dev.opera.com/articles/view/remote-debugging-with-opera-dragonfly/">for a long time</a>),&nbsp;<a href="http://www.iwebinspector.com/">Safari</a>&nbsp;(only in the iOS simulator though, but works for UIWebViews within apps).</p>
<p>Combine both features and you have a plugin-free alternative to Dev Mode. And it's called Super Dev Mode.</p>
<h2>So, how does it work?</h2>
<p>Super Dev Mode replaces the&nbsp;<em>code server</em>&nbsp;part of Dev Mode with a different implementation: it still serves&nbsp;<em>code</em>&nbsp;to the browser, but this time it compiles your Java code to non-optimized JavaScript&nbsp;(aka&nbsp;<em>draft</em>, hence its other name: Super Draft Mode).</p>
<p>For now, you have to run your app in an HTTP server of your choice (Dev Mode is OK for the job), because contrary to Dev Mode, Super Dev Mode is <em>only</em>&nbsp;the <em>code server</em>. This implies you have to compile your app once (if you use DevMode as the HTTP server, that shouldn't be necessary though). And until it's secured, you have to enable Super Dev Mode in your app when compiling it, by setting the <code>devModeRedirectEnabled</code> configuration property to true. Super Dev Mode also requires using the <code>xsiframe</code> linker, so you'll have to add those two lines to your GWT module (and remember: remove the last one for production!)</p>
{% highlight xml %}
<add-linker name="xsiframe" />
<set-configuration-property name="devModeRedirectEnabled" value="true" />
{% endhighlight %}

<p>After you load your app, enabling Super Dev Mode is only a matter of clicking a bookmarklet. That one will inject a script into the page, loaded from the <em>code server</em>, which will list the GWT modules that have been loaded in the page and ask you the one you want to debug. It'll then grab the deferred-binding property values for your browser and ask the <em>code server</em>&nbsp;to compile the associated permutation, and then reload the page to make use of it (some data is stored in your browser's session storage, and on load it triggers the injection of a script to load your app from the <em>code server</em>&nbsp;rather than from the HTTP server). Because the compiler is resilient, and it emits only a single permutation, the compilation should run in under 10 seconds; at least that's the goal (some generators have not yet been updated to take full advantage of incremental generation, and will slow down Super Dev Mode).</p>
<p>You'll then be able to see your Java code in Chrome Developer Tools, and you can set breakpoints into it, inspect variables, etc. as if you were in your Java IDE of choice debugging a Java application, except you're in your browser debugging JS. The net advantage compared to Dev Mode is that you can even step into your JSNI methods and inspect variables there. In case your browser doesn't support Source Maps, the JavaScript is compiled with -style PRETTY so it's relatively readable; but it'll really be better with Source Maps (just like <a href="https://github.com/jashkenas/coffee-script/issues/558">debugging CoffeeScript</a> would be better with Source Maps).</p>
<p>You can then make changes in your code (in Vim or Eclipse), and when you feel ready to test it, instead of reloading the page as you did with Dev Mode, you hit the bookmarklet again.</p>
<p>To turn Super Dev Mode off, you have another bookmarklet that clears the session storage and reloads the page, so that your compiled app will then be loaded.</p>
<p>The bookmarklets are available when accessing the root of the <em>code server</em>&nbsp;Web server (by default <code>http://localhost:9876</code>): simply drag and drop the two links into your bookmarks bar.</p>
<p>In a few words: Super Dev Mode loads a resilient GWT compiler with an endpoint to recompile a permutation on-the-fly as fast as possible, and serves the emitted files, as well the associated Source Maps and Java source files.</p>
<h2>Limitations, and security</h2>
<p>Technically, compilation is currently triggered using JSONP, because of the need to bypass the Same Origin Policy. We've been discussing using CORS instead, which would have the added benefit of allowing a whitelist of apps' origins (with error-detection on the client-side to warn you when you forgot to whitelist your app, or in case you forgot to launch the <em>code server</em>).</p>
<p>Super Dev Mode compiles your app in a new folder each time, so your <code>.gwt.rpc</code> files won't be available to your server-side code until you copy them to your <em>war directory</em>, or unless you've overriden <code>loadSerializationPolicy</code> to search your Super Dev Mode <em>app space</em>&nbsp;(I doubt it'd be possible if you use App Engine though). You shouldn't have any problem with RequestFactory though.</p>
<h2>What's next?</h2>
<p>Super Dev Mode is still an experimental (<em>very</em> experimental) feature, so don't expect too much for now. Your feedback is welcome though, either in the form of <a href="http://code.google.com/p/google-web-toolkit/issues/list">bug reports</a>, or suggestions <a href="https://groups.google.com/forum/#!forum/google-web-toolkit">on the forum</a>. Super Dev Mode will be packaged in GWT 2.5, and deployed to The Central Repository (for Maven/Gradle/Ivy/etc. users).</p>
<p>Expect many improvements to Super Dev Mode (as well as many other changes in GWT) after the 2.5 release ;-)</p>
