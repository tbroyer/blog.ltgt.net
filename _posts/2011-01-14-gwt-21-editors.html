---
layout: post
title: GWT 2.1 Editors
published: true
old_discuss_url: https://profiles.google.com/113945685385052458154/buzz/gTtjui9Daxq
---
<p>GWT 2.1 is <a href="http://code.google.com/webtoolkit/" title="Google Web Toolkit">advertized</a> as providing "<em>a framework for business apps</em>", and one of the included features is the <a href="http://code.google.com/webtoolkit/doc/latest/DevGuideUiEditors.html" title="Developer's Guide - Editors - Google Web Toolkit">Editor framework</a>, which provides data binding between bean-like objects and UI fields.</p>
<h2>The Basics</h2>
<p>On one hand you have an object graph that you want to display or edit, and on the other hand a set of widgets (let's call them <em>editors</em>, we'll see the why later). To use them together so that your objects are displayed in the editors, you'll use an <em>editor driver</em>.</p>
<p>GWT 2.1 comes with two editor drivers: the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/SimpleBeanEditorDriver.html"><code>SimpleBeanEditorDriver</code></a> and the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/client/RequestFactoryEditorDriver.html"><code>RequestFactoryEditorDriver</code></a>. Similarly to <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/uibinder/client/UiBinder.html"><code>UiBinder</code></a>, you'll declare an interface extending one of these with generic parameters.</p>
<p>The kind of objects that you can edit depends on the editor driver you use, but in any case they'll be bean-like objects. <code>SimpleBeanEditorDriver</code> edits any simple Java bean while <code>RequestFactoryEditorDriver</code> expects only <a href="{% post_url 2011-01-10-gwt-211-requestfactory %}" title="GWT 2.1.1 RequestFactory">RequestFactory proxies</a>; and in case that's not enough (really?), it's technically possible to create your own editor driver flavor (and it's not that much work, though you have to be familiar with the editor framework internals).</p>
<p>Finally, editors are any class that implement the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/Editor.html"><code>Editor</code></a> marker-interface or the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/IsEditor.html"><code>IsEditor</code></a> interface. There are further constraints and features, and that's the whole point of this article, as we'll see below.</p>
<h2>Editor drivers</h2>
<p>Both editor driver interfaces have two generic parameters: the type of the object being displayed or edited (I'll always use <em>edited</em> from now on, but editors can be read-only, and thus only <em>display</em> data), and the type of the root editor.</p>
<p>The GWT Editor framework makes extensive use of code generation. Because everything is done at compile-time by inspecting classes, it means everything is based on the types you use in your interface declaration (and for sub-editors, see below, the field and method declarations). If you then use the generated code on a subclass of the editor for instance, only the bits inherited (and possibly overridden) from the declared editor type.</p>
<p>The Editor framework uses a <a href="http://martinfowler.com/eaaDev/FlowSynchronization.html" title="Flow Synchronization">Flow Synchronization</a> pattern: you <em>edit</em> an object for the editor driver to populate editors from the object's values, and you later <em>flush</em> the editor driver to copy editors' values back into the edited object. During a flush, editors have an opportunity to report errors that will be available as <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/EditorError.html"><code>EditorError</code></a>s.</p>
<p>The <code>SimpleBeanEditorDriver</code> provides just that: an <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/SimpleBeanEditorDriver.html#edit(T)"><code>edit()</code></a> method, a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/SimpleBeanEditorDriver.html#flush()"><code>flush()</code></a> method, and a pair of <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/SimpleBeanEditorDriver.html#hasErrors()"><code>hasErrors()</code></a> and <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/SimpleBeanEditorDriver.html#getErrors()"><code>getErrors()</code></a> accessors. But before you <code>edit()</code> an object, you'll first have to <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/SimpleBeanEditorDriver.html#initialize(E)"><code>initialize()</code></a> the editor driver with the actual editor instance to be used.</p>
<p>We'll look at the <code>RequestFactoryEditorDriver</code> later.</p>
<h2>Editors</h2>
<p>Editors are a graph of objects used to edit objects. Each editor is bound to a type of object that it can edit. Starting from a root editor type, the <em>editor driver generator</em> will build a representation of the editors tree using reflection: any non-private field or non-private no-args method whose (return) type is an editor will be seen as a sub-editor, unless it is annotated with <code>@<a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/Editor.Ignore.html">Ignore</a></code>. The name of the edited property will be infered from the field or method name (it will be field/method name after an optional <code>Editor</code> suffix has been removed), unless it is annotated with <code>@<a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/Editor.Path.html">Path</a></code> (which can use the dotted notation to reference a sub-property; in GWT 2.2 you'll also be able to use the empty string to reference the current object). At runtime, if any of these sub-editors is null, it will simply be ignored. This is known as <a href="http://code.google.com/webtoolkit/doc/latest/DevGuideUiEditors.html#Editor_contract">the Editor contract</a>.</p>
<p>A field or method will be treated as an editor if its type implements the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/Editor.html"><code>Editor</code></a> marker interface (or one of its subinterfaces, see below) or the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/IsEditor.html"><code>IsEditor</code></a> interface. There are several kinds of editors:</p>
<ul>
<li>an <code>IsEditor</code> returns an Editor from its <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/IsEditor.html#asEditor()">asEditor()</a> method. When building its editors tree, the editor driver generator will descend into the <code>Editor</code>'s type.</li>
<li>a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/LeafValueEditor.html"><code>LeafValueEditor</code></a> represents a leaf in the editors tree. The <em>editor driver generator</em> won't try to find sub-editors.</li>
<li>a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/CompositeEditor.html"><code>CompositeEditor</code></a> contains an unknown, dynamic number of sub-editors of the same type. There are several built-in <code>CompositeEditor</code> to edit <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/adapters/OptionalFieldEditor.html">an optional value</a> or conveniently adapt a <code>List</code> of objects: the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/adapters/ListEditor.html"><code>ListEditor</code></a> with which you manage the sub-editors display, and the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/adapters/HasDataEditor.html"><code>HasDataEditor</code></a> which uses a <a href="http://code.google.com/webtoolkit/doc/latest/DevGuideUiCellWidgets.html" title="Developer's Guide - Data Presentation Widgets (Cell Widgets) - Google Web Toolkit">Data Presentation widget</a> (such as a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/user/cellview/client/CellList.html"><code>CellList</code></a> or <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/user/cellview/client/CellTable.html"><code>CellTable</code></a>) to edit the objects in the list.</li>
</ul>
<p>Editors can also implement a couple of other interfaces to extend their behavior:</p>
<ul>
<li>a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/HasEditorDelegate.html"><code>HasEditorDelegate</code></a> will be passed an <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/EditorDelegate.html"><code>EditorDelegate</code></a> on which it can <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/EditorDelegate.html#recordError(java.lang.String, java.lang.Object, java.lang.Object)">report errors</a> and <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/EditorDelegate.html#subscribe()">subscribe</a> for changes to the edited object (only supported by the <code>RequestFactoryEditorDriver</code>)</li>
<li>a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/HasEditorErrors.html"><code>HasEditorErrors</code></a> will be notified of errors to display them to the user</li>
<li>a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/ValueAwareEditor.html"><code>ValueAwareEditor</code></a> will be <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/ValueAwareEditor.html#setValue(T)">notified of the value</a> being edited (otherwise, the Editor framework simply descends into sub-editors down to <code>LeafValueEditor</code>s) and <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/ValueAwareEditor.html#onPropertyChange(java.lang.String...)">changes to its properties</a> (currently unimplemented AFAICT), and be given the opportunity to do some additional work during the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/editor/client/ValueAwareEditor.html#flush()"><code>flush()</code></a> of the editors back to the edited objects.</li>
</ul>
<p>Most widgets displaying or editing values are already editors (most are actually <code>IsEditor</code>s of <a href="http://code.google.com/webtoolkit/doc/latest/DevGuideUiEditors.html#Provided_Adapters" title="Provided adapters">editor adapters</a>): TextBox, Label, DateBox, CheckBox, etc. and a few widgets have been added to add type specialization: IntegerBox, DoubleBox, NumberLabel, DateLabel, etc. This makes the Editor framework a very good friend of UiBinder!</p>
<h2>Integration with RequestFactory</h2>
<p>The <code>RequestFactoryEditorDriver</code> is similar to the <code>SimpleBeanEditorDriver</code> but with a few key differences:</p>
<ul>
<li>First, the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/client/RequestFactoryEditorDriver.html#initialize(com.google.gwt.requestfactory.shared.RequestFactory, E)"><code>initialize()</code></a> method can also take a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/shared/RequestFactory.html"><code>RequestFactory</code></a>and/or an <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/event/shared/EventBus.html"><code>EventBus</code></a> to listen to <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/shared/EntityProxyChange.html"><code>EntityProxyChange</code></a> events; it will then <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/shared/RequestFactory.html#find(com.google.gwt.requestfactory.shared.EntityProxyId)"><code>find()</code></a> the object back from the server and refresh the editors.</li>
<li>The <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/client/RequestFactoryEditorDriver.html#edit(P, com.google.gwt.requestfactory.shared.RequestContext)"><code>edit()</code></a> method expects both the object to be editor and a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/shared/RequestContext.html"><code>RequestContext</code></a> (so the driver can ensure all objects in the graph are mutable, by calling the <code>RequestContext</code>'s <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/shared/RequestContext.html#edit(T)"><code>edit()</code></a> method.</li>
<li>If you just want to display a proxy, you can use the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/client/RequestFactoryEditorDriver.html#display(P)"><code>display()</code></a> method, which works seamlessly with immutable objects.</li>
<li>The <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/client/RequestFactoryEditorDriver.html#flush()"><code>flush()</code></a> method doesn't return the edited object, but the <code>RequestContext</code> passed to the <code>edit()</code> method.</li>
<li>A <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/client/RequestFactoryEditorDriver.html#getPaths()"><code>getPaths()</code></a> method returns the list of all the properties being edited, and can be passed to a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/shared/Request.html"><code>Request</code></a>'s <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/shared/Request.html#with(java.lang.String...)"><code>with()</code></a> to only ask the server for those properties.</li>
<li>Finally, you can display errors reported out-of-band (e.g. by the server) with the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/requestfactory/client/RequestFactoryEditorDriver.html#setViolations(java.lang.Iterable)"><code>setViolations()</code></a> method. Note that in GWT 2.2 this method is <a href="http://gwt-code-reviews.appspot.com/1260801/show" title="Add support for mapping ConstraintViolation objects into SimpleBeanEditor.">expected</a> to be deprecated and replaced with a <code>setConstaintViolations</code> that will also be available on the <code>SimpleBeanEditorDriver</code>.</li>
</ul>
<h2>Conclusion</h2>
<p>The GWT Editor framework is a real time-saver, because you no longer have to maintain the code to push your objects' properties into widgets and back to the objects, and you therefore no longer have to test that code (because as soon as you add a field, you'll probably copy/paste lines and can miss a change, injecting a property into the wrong field, or a field's value into the wrong property). As a proof of that, I've quickly drafted a <a href="https://gist.github.com/780560">before/after sample</a> (only files that are necessary to understand the code are included, and I know there are typos and missing imports, but using <a href="https://github.com/blog/595-diff-your-gist">this user script or Chrome extension</a> you can then easily see a diff between the 2 versions)</p>
